<!DOCTYPE html>
<html>
	<head>
		<title>{{.Title}}</title>
		<link rel="shortcut icon" type="image/x-icon" href="res/file-sharing.jpg" />
		<link href="res/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
		<link href="res/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="res/dropzone/css/basic.css" rel="stylesheet">
		<link href="res/dropzone/css/dropzone.css" rel="stylesheet">
		<script type="text/javascript" src="res/jquery/js/jquery.min.js"></script>
		<script type="text/javascript" src="res/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="res/dropzone/dropzone.js"></script>
	</head>
	<body>
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="page-header">
					<h3>{{.Title}} >
						<button id="showTextSharingBoxBtn" type="submit" class="btn btn-primary">Text</button>
					</h3>
				</div>
				<form action="/upload/" id="dropzone" class="dropzone" method="post" enctype="multipart/form-data">
					<div class="form-group">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th class="col-md-1">#</th>
									<th class="col-md-8">Name</th>
									<th class="col-md-2">Size</th>
                                   <th class="col-md-1">Action</th>
								</tr>
							</thead>
							<tbody id="rows">
							{{range $index, $fileInfo := .FileInfoList}}
								<tr id="row_{{$index}}">
									<td>{{increment $index}}</td>
									<td id="name"><a href='{{$fileInfo.Path}}'>{{$fileInfo.Name}}</a></td>
									<td>{{$fileInfo.Size}}</td>
                                   <td><input type="button" onclick="removeFileRequest({{$index}}, '{{$fileInfo.Name}}')" value="&times;"></input></td>
								</tr>
							{{end}}
							</tbody>
						</table>
					</div>
				</form>
			</div>
		</div>

		<div id="textSharingBox" class="modal fade">
		    <div class="modal-dialog">
		        <div class="panel modal-content">
		            <div class="panel-heading modal-header">
		                <button id="closeBtn" class="close col-sm-1" aria-hidden="true">&times;</button>
		                <h4 class="modal-title">{{.Title}}</h4>
		            </div>
		            <div class="panel-body modal-body">
						<h1>Coming soon!!!<h1>
		            </div>
					<div class="modal-footer">
						<button id="okBtn" type="submit" class="btn btn-success col-md-offset-6">Ok</button>
					</div>
		        </div>
		    </div>
		</div>

		<script>
            // disable confirmation dialog
            Dropzone.confirm = function(question, accepted, rejected) {
                   return accepted()
            }

            // setup dropzone
			Dropzone.options.dropzone = {
				paramName: "file", // The name that will be used to transfer the file
				maxFilesize: 10000, // MB
				addRemoveLinks: true,
				dictCancelUpload: "Cancel",
				dictRemoveFile: "Remove",
				init: function() {
					var self = this

    				this.on("canceled", function(file) {
                       	self.removeFile(file)
					})

					this.on("removedfile", function(file) {
                        removeFileRequest(file.name)
                    })

                    this.on("queuecomplete", function(){
                        location.reload()
                    })
  				},
			}

			var removeFileRequest = function(idx, fileName) {
				$.ajax({
  					type: "POST",
  					url: "/remove/",
  					data: {"fileName": fileName},
                    success: function() {
                        $("#row_"+idx).remove()
                    },
                    error: function() {
                        alert("can't remove " + fileName)
                    }
				})
			}

		    $('#showTextSharingBoxBtn').on('click', function () {
				$('#textSharingBox').modal('show')
			})

			var onCloseTextSharingBox = function() {
				$('#textSharingBox').modal('hide')
			}

			$('#closeBtn').on('click', onCloseTextSharingBox)
			$('#okBtn').on('click', onCloseTextSharingBox)
		</script>
	</body>
</html>
