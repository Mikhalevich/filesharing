<!DOCTYPE html>
<html>
	<head>
		<title>{{.Title}}</title>
		<link rel="shortcut icon" type="image/x-icon" href="res/file-sharing.jpg" />
		<link href="res/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
		<link href="res/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="res/dropzone/css/basic.css" rel="stylesheet">
		<link href="res/dropzone/css/dropzone.css" rel="stylesheet">
		<script type="text/javascript" src="res/jquery/js/jquery.min.js"></script>
		<script type="text/javascript" src="res/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="res/dropzone/dropzone.js"></script>
	</head>
	<body>
		<div class="row">
			<div class="col-md-10 col-md-offset-1">
				<div class="page-header">
					<h3>{{.Title}} >
						<!--<button id="showUploadingBoxBtn" type="submit" class="btn btn-primary">File</button>-->
					</h3>
				</div>
				<form action="/upload/" id="dropzone" class="dropzone" method="post" enctype="multipart/form-data">
					<div class="form-group">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th class="col-md-1">#</th>
									<th class="col-md-8">Name</th>
									<th class="col-md-2">Size</th>
                                   <th class="col-md-1">Action</th>
								</tr>
							</thead>
							<tbody>
							{{range $index, $fileInfo := .FileInfoList}}
								<tr>
									<td>{{increment $index}}</td>
									<td id="name"><a href='{{$fileInfo.Path}}'>{{$fileInfo.Name}}</a></td>
									<td>{{$fileInfo.Size}}</td>
                                   <td><button id="removeBtn">&times;</button></td>
								</tr>
							{{end}}
							</tbody>
						</table>
					</div>
				</form>
			</div>
		</div>

		<div id="uploadingBox" class="modal fade">
		    <div class="modal-dialog">
		        <div class="panel modal-content">
		            <div class="panel-heading modal-header">
		                <button id="closeBtn" class="close col-sm-1" aria-hidden="true">&times;</button>
		                <h4 class="modal-title">{{.Title}}</h4>
		            </div>
		            <div class="panel-body modal-body">
						<form action="/upload/" id="dropzone" class="dropzone" method="post" enctype="multipart/form-data"></form>
		            </div>
					<div class="modal-footer">
						<button id="okBtn" type="submit" class="btn btn-success col-md-offset-6">Ok</button>
					</div>
		        </div>
		    </div>
		</div>

		<script>
            // disable confirmation dialog
            Dropzone.confirm = function(question, accepted, rejected) {
                   return accepted()
            }
            
            // setup dropzone
			Dropzone.options.dropzone = {
				paramName: "file", // The name that will be used to transfer the file
				maxFilesize: 10000, // MB
				addRemoveLinks: true,
				dictCancelUpload: "Cancel",
				dictRemoveFile: "Remove",
				init: function() {
					var self = this
					
    				this.on("canceled", function(file) {
                       	self.removeFile(file)
					})
						
					this.on("removedfile", function(file) {
                        removeFileRequest(file.name)
                    })
                    
                    this.on("queuecomplete", function(){
                        location.reload()	
                    })                    
  				},               
			}
			
			var removeFileRequest = function(fileName) {
				$.ajax({
  					type: "POST",
  					url: "/remove/",
  					data: "fileName=" + fileName,
                    success: function() {
                        location.reload();
                    }
				})
			}			
			
		    $('#showUploadingBoxBtn').on('click', function () {
				$('#uploadingBox').modal('show')
			})

			var onCloseUploadingBox = function() {
				$('#uploadingBox').modal('hide')

				location.reload();
			}

			$('#closeBtn').on('click', onCloseUploadingBox)
			$('#okBtn').on('click', onCloseUploadingBox)
            
            $('#removeBtn').on('click', function(event) {
                var fileName = $(event.target).parent().siblings("#name").text()
                
                removeFileRequest(fileName)
            })
		</script>
	</body>
</html>